name: Daily Import

on:
  schedule:
    # Run daily at 5 AM UTC (1 hour before public backup at 6 AM)
    - cron: '0 5 * * *'
  workflow_dispatch:
    # Allow manual trigger from GitHub Actions UI

jobs:
  import:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger import from Secular Solstice
        run: |
          APP_URL="${{ secrets.APP_URL }}"
          APP_URL="${APP_URL%/}"
          HTTP_CODE=$(curl -s -w "%{http_code}" -o response.txt \
            -L --post301 --post302 --post303 \
            -X POST \
            -H "Authorization: Bearer ${{ secrets.IMPORT_SECRET }}" \
            "${APP_URL}/api/admin/import-secular-solstice")
          echo "HTTP Code: $HTTP_CODE"
          cat response.txt
          if [ "$HTTP_CODE" != "200" ]; then
            echo "Import API returned error"
            exit 1
          fi
          echo "Import completed successfully"
